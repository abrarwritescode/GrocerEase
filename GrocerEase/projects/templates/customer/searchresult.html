<!DOCTYPE html>
{% load static %}
<html lang="en">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrocerEase | Home</title>
    <link rel="shortcut icon" type="image/png" href="{% static 'assets/assets1/img/favicon.png' %}">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'assets/assets1/css/main.css' %}">
    <link rel="stylesheet" href="{% static 'assets/assets1/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/assets1/css/owl.carousel.css' %}">

    <link rel="stylesheet" href="{% static 'assets/assets2/css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'assets/assets2/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/assets2/css/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/assets2/css/flaticon.css' %}">
    <link rel="stylesheet" href="{% static 'assets/assets2/css/icomoon.css' %}">

    <link rel="stylesheet" href="{% static 'assets/assets3/css/style.css' %}">
<style>
  /* Add styles for out-of-stock items */
  .out-of-stock {
      filter: blur(1px); /* Apply a blur effect to the item */
      opacity: 0.5; /* Reduce opacity to indicate it's out of stock */
      pointer-events: none; /* Disable pointer events so it can't be clicked */
  }
  .out-of-stock-label {
    display: block;
    background-color: red;
    color: white;
    font-size: 14px;
    padding: 4px 8px;
    border-radius: 4px;
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1;
    opacity: 0; 
  animation: fade-in 0.5s ease-in-out forwards; 
  }
  
  @keyframes fade-in {
  from {
    opacity: 0; /* Start with zero opacity */
  }
  to {
    opacity: 1; /* Fade in to full opacity */
  }

}
  
  
  
  </style>
   <body>
    <div class="search-body-area-result footer-area">
            
							<div style="justify-content: center; align-items: center; position: relative; bottom: 320px;" class="row">
								{% for item in items %} 
									<div class="col-md-6 col-lg-3 ftco-animate">
										<div class="product">
											<a href="#" class="img-prod"><img class="img-fluid" src="{{ item.itemfeaturedimage.url }}" alt="">
												<div class="overlay"></div>
                        {% if item.itemquantity <= 0 %}
                        <span class="out-of-stock-label">Out of Stock</span>
                        {% endif %}

											</a>
											<div class="text py-3 pb-4 px-3 text-center">
												<h3><strong>{{item.itemtitle}}</strong></h3>
												<div class="d-flex">
													<div class="pricing">
														<p class="price"><span class="price-sale">BDT {{item.itemprice}}</span></p>
													</div>
												</div>
												<div class="bottom-area d-flex px-3">
													<div class="m-auto d-flex">
														<a href="{% url 'singleitemcustomer' pk=item.id customer_id=request.session.customer_id %}" class="add-to-cart d-flex justify-content-center align-items-center text-center">
                              <span><i class="ion-ios-menu"></i></span>
                          </a>
                          
                        <a href="{% url 'cart' customer_id=request.session.customer_id %}" data-product="{{item.id}}" data-action="add" class="add-btn update-cart add-to-cart buy-now d-flex justify-content-center align-items-center mx-1 {% if item.itemquantity <= 0 %}out-of-stock{% endif %}">
                            <span><i class="ion-ios-cart"></i></span>
                        </a>  
                        
                        <a href="{% url 'togglefavorite' pk=item.id customer_id=request.session.customer_id %}" class="toggle-favorite d-flex justify-content-center align-items-center text-center" data-item-id="{{ item.id }}" data-user-id="{{ request.session.customer_id }}">
                          <span><i class="ion-ios-heart"></i></span>
                      </a>
							
													</div>
												</div>
											</div>
										</div>
									</div>
								{% endfor %}
							  </div>
							
    </div>
    <script src="{% static 'assets/assets1/js/jquery-1.11.3.min.js' %}"></script>
    <script src="{% static 'assets/assets1/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'assets/assets1/js/jquery.countdown.js' %}"></script>
    <script src="{% static 'assets/assets1/js/jquery.isotope-3.0.6.min.js' %}"></script>
    <script src="{% static 'assets/assets1/js/waypoints.js' %}"></script>
    <script src="{% static 'assets/assets1/js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'assets/assets1/js/jquery.magnific-popup.min.js' %}"></script>
    <script src="{% static 'assets/assets1/js/jquery.meanmenu.min.js' %}"></script>
    <script src="{% static 'assets/assets1/js/sticker.js' %}"></script>
    <script src="{% static 'assets/assets1/js/main.js' %}"></script>

    <script src="{% static 'assets/assets2/js/jquery.min.js' %}"></script>
    <script src="{% static 'assets/assets2/js/jquery-migrate-3.0.1.min.js' %}"></script>
    <script src="{% static 'assets/assets2/js/jquery.easing.1.3.js' %}"></script>
    <script src="{% static 'assets/assets2/js/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'assets/assets2/js/jquery.stellar.min.js' %}"></script>
    <script src="{% static 'assets/assets2/js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'assets/assets2/js/jquery.magnific-popup.min.js' %}"></script>
    <script src="{% static 'assets/assets2/js/aos.js' %}"></script>
    <script src="{% static 'assets/assets2/js/scrollax.min.js' %}"></script>
    <script src="{% static 'assets/assets2/js/main.js' %}"></script>

    <script src="{% static 'assets/assets3/js/jquery.slicknav.js' %}"></script>
    <script src="{% static 'assets/assets3/js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'assets/assets3/js/main.js' %}"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	  <script>
	  
		  $(document).ready(function () {
			  const toggleFavorite = $('.toggle-favorite');
			  const favoriteCount = $('#favorite-count');
			  
			  toggleFavorite.each(function () {
				  const link = $(this);
				  const icon = link.find('i');
				  const itemId = link.attr('data-item-id');
				  const userId = link.attr('data-user-id'); 
				  
				  // Construct a unique key for this specific item and user
				  const storageKey = 'favorite_' + userId + '_' + itemId;
				  const isFavorite = localStorage.getItem(storageKey) === 'true';
				  
				  // Initialize the icon based on the favorite state
				  updateIcon(link, isFavorite);
		  
				  link.on('click', function(event) {
					  event.preventDefault();
					  const url = link.attr('href');
					  
					  $.get(url)
					  .done(function(data) {
						  const isFavorite = data.is_favorite;
						  
						  // Update the icon and local storage for this specific item and user
						  updateIcon(link, isFavorite);
						  localStorage.setItem(storageKey, isFavorite.toString());
						  
						  updateFavoriteCount();
					  })
					  .fail(function(jqXHR, textStatus, errorThrown) {
						  console.error("Failed to toggle favorite:", textStatus, errorThrown);
					  });
				  });
			  });
			  
			  // Function to update the icon based on the item's state (favorite or not)
			  function updateIcon(link, isFavorite) {
				  const icon = link.find('i');
				  if (isFavorite) {
					  icon.removeClass('ion-ios-heart-empty').addClass('ion-ios-heart');
				  } else {
					  icon.removeClass('ion-ios-heart').addClass('ion-ios-heart-empty');
				  }
			  }
			  
			  // Function to update the favorite count
			  function updateFavoriteCount() {
				  $.get("{% url 'getfavoritescount' customer_id=request.session.customer_id %}")
				  .done(function(data) {
					  const count = data.favorite_count;
					  favoriteCount.text(count);
					  
					  if (count === 0 && favoriteCount.is(':visible')) {
						  favoriteCount.hide();
					  } else if (count > 0) {
						  favoriteCount.show();
					  }
				  })
				  .fail(function(jqXHR, textStatus, errorThrown) {
					  console.error("AJAX request failed:", textStatus, errorThrown);
				  });
			  }
			  
			  // Fetch and update the initial favorite count
			  updateFavoriteCount();
		  });
		  
		  
	  </script>
    

   </body>
</html>
