<html>
    {% load static %}
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="shortcut icon" type="image/png" href="{% static 'pictures/faviconcart.png' %}">
    <title>GrocerEase | Home</title>
    </head>

<style>
    
*,
*::before,
*::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
   
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    color: #4f546c;
    font-size: 0.9rem;
    background-color: rgb(204, 207, 209);
    padding-top: 90px;
}

table {
    border-collapse: collapse;
    background-color: white;
    text-align: left;
    overflow: hidden;
    margin-top: 70px;
    position: relative;
    left: 10px;
}

table thead {
    box-shadow: 0 5px 10px #e8eaef;
}

table th {
    padding: 1rem 2rem;
    text-transform: uppercase;
    letter-spacing: 0.1rem;
    font-size: 1rem;
    font-weight: 700;
    font-family: Arial, sans-serif;
    color: #333333;
}

@media screen and (max-width: 768px) {
    table th {
        font-size: 0.8rem;
    }
}

table td {
    padding: 1rem 2rem;
    font-family: Arial, sans-serif;
    font-size: 0.9rem;
    font-weight: 400;
    color: #333333;
    text-align: center;
    border: 1px solid #dcdbdb;
}

@media screen and (max-width: 768px) {
    table td {
        font-size: 0.8rem;
    }
}


table .amount {
    text-align: right;
}

table tr:last-child {
    background-color: #dfe3e5;
}

h1 {
    font-size: 2rem;
    color: #042405;
    margin-top: 10px;
    text-align: center;
    text-transform: uppercase;
    font-weight: bold;
    padding: 10px;
    position: relative;
    top: 50px;
}

@media screen and (max-width: 768px) {
    h1 {
        font-size: 1.5rem;
        padding: 8px;
    }
}
.container {
    position: relative;
}

.container h1 {
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    margin-top: 10px;
}

.action-buttons {
    display: flex;
    justify-content: space-between;
}

.action-buttons input[type="submit"] {
    padding: 8px 12px;
    font-size: 0.8rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.action-buttons input[type="submit"].markshipped {
    background-color: rgb(252, 108, 56);
    color: #fff;
    position: relative;
    top: 26px;
}

.action-buttons input[type="submit"].shipped {
    background-color: rgb(32, 213, 32);
    color: #fff;
    margin-left: 50px;
}

.action-buttons input[type="submit"].delivered {
    background-color: #0ba6ff;
    color: #fff;
    margin-left: 50px;
}

.action-buttons input[type="submit"].cancell {
    background-color: red;
    color: #fff;
    margin-left: 130px;
    position: relative;
    bottom: 10px;
}

.action-buttons input[type="submit"].cancel {
    background-color: red;
    color: #fff;
    margin-left: 25px;
}

.action-buttons input[type="submit"]:hover {
    opacity: 0.8;
}

.notification-content {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    width: 300px; /* Adjust the width as needed */
    max-height: 300px; /* Set a maximum height for scrolling */
    overflow-y: auto; /* Enable vertical scrolling when content exceeds max-height */
    background-color: #081b0a;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    padding: 10px;
    border: 1px solid #ddd;
    color: white;
    z-index: 1;
	}
   
	#notification-count {
		display: inline-block;
		background-color: red; /* Set your desired background color */
		color: white; /* Set the text color */
		border-radius: 50%; /* Make it a circle using border-radius */
		width: 16px; /* Set the width and height to control the size */
		height: 18px;
		position: absolute;
		text-align: center;
		line-height: 20px; /* Vertically center the text */
		margin-left: 5px; /* Add some spacing to the left of the count */
		top: 30px; /* Adjust this value to control the vertical position */
		font-size: 12px;
	}
	

</style>
<body>

    <header style="position: fixed; top: 0px; z-index: 1000;" class="navbar">
        <div class="logo">
			<a href="{% url 'homeseller' seller_id=request.session.seller_id %}">
				<img class="logoimage" src="{% static 'pictures/logo.png' %}" alt="">	
			</a>
        </div>
		<div class="icons">

			<a style="color: #042405;" class="mobile-hide search-bar-icon icon" href="{% url 'searchseller' seller_id=request.session.seller_id  %}"><i class="fas fa-search"></i></a> 
			<a href="#" id="view-notifications" class="notification-trigger">
				<i class="fas fa-bell"></i>
				<span id="notification-count"></span>
			</a><div id="notifications" class="notification-content"></div>
		   
			<a style="color: #042405;" href="{% url 'sellerprofile' seller_id=request.session.seller_id %}" class="aboutus icon"><i class="fas fa-user"></i></a>
			
		</div>											

        <div class="navbtn">
			<a href="{% url 'uploaditem' seller_id=request.session.seller_id %}" class="btnn-login">Upload</a>
			<a href="{% url 'logoutseller' %}" class="btnn-signup">Logout</a>
		</div>
    </header>

    <div class="container">
        <h1 style="position: relative; top: 20px;">My Orders</h1>
        {% for order_info in orders_info  %}
            <table>
                <thead>
                    <tr>
                        <th>Order Number: {{ order_info.order.id }}</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>{{ order_info.order.date_ordered }}</th>
                    </tr>
                    <tr>
                        <th>Items</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Category</th>
                        <th>Image</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order_item in order_info.items %}
                        <tr>
                            <td>{{ order_item.product.itemtitle }}</td>
                            <td>{{ order_item.product.itemprice }}</td>
                            <td>{{ order_item.quantity }}</td>
                            <td>
                                {% for category in order_item.product.category.all %}
                                    {{ category.categoryname }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </td>
                            <td class="product-image">
                                <img src="{{ order_item.product.itemfeaturedimage.url }}" alt="">
                            </td>
                        {% if order_item.status == 'Processing' %}
                            <td>
                                <form action="{% url 'vieworders' seller_id=request.session.seller_id %}" method="post" class="action-buttons">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="MARK_SHIPPED">
                                        <input type="hidden" name="order_item_id" value="{{ order_item.id }}">
                                    <input type="submit" value="MARK SHIPPED" class="btn markshipped button" name="accept">
                                </form>
                                
                                <form action="{% url 'vieworders' seller_id=request.session.seller_id %}" method="post" class="action-buttons">
                                    {% csrf_token %}
                                    <input type="hidden" name="action1" value="CANCEL">
                                        <input type="hidden" name="order_item_id1" value="{{ order_item.id }}">
                                    <input type="submit" value="CANCEL" class="btn cancell button" name="accept1">
                                </form>
                                              
                            </td>
                            {% elif order_item.status == 'Shipped' %}
                            {% if order_item.order.status == 'Processing' %}
                                <td>
                                    <form action="#" class="action-buttons">
                                        <input type="submit" value="SHIPPED" class="btn shipped button" name="accept">
                                    </form>
                                </td>
                            {% elif order_item.order.status == 'Delivered' %}
                                <td>
                                    <form action="#" class="action-buttons">
                                        <input type="submit" value="DELIVERED" class="btn delivered button" name="accept3">
                                    </form>
                                </td>
                            {% endif %}
                        
                        {% elif order_item.status == 'Cancelled' or order_item.status == 'Refunded' or order_item.status == 'Refunding In Progress' %}
                            <td>
                                <form action="#" class="action-buttons">
                                    <input type="submit" value="ORDER CANCELLED" class="btn cancel button" name="accept1">
                                </form>                
                            </td>
                    
                        {% endif %}
                        </tr> 
                    {% endfor %}

                    <tr>
                        <td><b>Customer's Address:</b> </td>
                        <td>{{ order_info.order.shipping_address }}</td>
                        <td><b>Contact:</b> </td>
                        <td>{{ order_info.order.shipping_phone }}</td>

                    <td><b>Email:</b></td>
                    <td>{{ order_info.order.shipping_email }}</td>
                    </tr>
                </tbody>
            </table>
        {% endfor %}
    </div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<script src="{% static 'js/main.js' %}"></script>
<script type="text/javascript" src="{% static 'js/cart.js' %}"></script>

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const rotatingElement = document.getElementById("js-rotating");
    const phrases = ["Get varieties of collection", "At you doorstep", "GrocerEase"]; // Add more phrases as needed
    let index = 0;

    function rotateText() {
        rotatingElement.textContent = phrases[index];
        index = (index + 1) % phrases.length;

        setTimeout(rotateText, 3000); 
    }

    rotateText();
});
</script>

<script>

// Function to get a specific cookie value by name
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

$(document).ready(function () {
    const viewNotificationsLink = $('#view-notifications');
    const notificationsContainer = $('#notifications');
    const csrfToken = getCookie("csrftoken");
    const notificationCount = $('#notification-count');

    // Function to update the notification count
    function updateNotificationCount() {
        $.get("{% url 'getnotificationcount' seller_id=request.session.seller_id %}", function (data) {
            const count = data.count;
            notificationCount.text(count);
    
            // Only hide the count if it's zero and was previously displayed
            if (count === 0 && notificationCount.is(':visible')) {
                notificationCount.hide();
            } else if (count > 0) {
                notificationCount.show();
            }
            
        });
    }

    // Fetch and update the initial notification count
    updateNotificationCount();

    // Handle clicking on the "View Notifications" link
    viewNotificationsLink.on("click", function (event) {
        event.preventDefault();

        // Include the CSRF token in the headers
        const headers = new Headers({
            'X-CSRFToken': csrfToken
        });

        // Make an AJAX request to fetch notifications.
        $.get("{% url 'notifications' seller_id=request.session.seller_id %}", function (data) {
            notificationsContainer.html(data.notifications);
            notificationsContainer.show();
            // Mark notifications as read when the dropdown is opened
            $.post("{% url 'marknotificationsasread' seller_id=request.session.seller_id %}", { csrfmiddlewaretoken: csrfToken },
            function () {
                // Update the notification count after marking as read
                updateNotificationCount();
            });
        });
    });
});
</script>

</body>


</html>